<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.pe.hayarobys.nox.common.upload.UploadDAO">
	<resultMap type="kr.pe.hayarobys.nox.common.upload.FileVO" id="FileVO">
		<result column="FILE_SQ_PK" property="fileNo" />	<!-- 파일 시퀀스 기본키 -->
		<result column="FILE_SIZE" property="fileSize" />	<!-- 파일 크기 -->
		<result column="ORGN_FILE_NM" property="originalFileName" />	<!-- 원본 파일 이름 -->
		<result column="SAVE_FILE_NM" property="saveFileName" />	<!-- 저장 파일 이름 -->
	</resultMap>
	
	<!-- 파일 정보를 DB에 등록하고 생성된 파일 일련 번호를 반환합니다. -->
	<insert id="insertFile" parameterType="FileVO">
		INSERT INTO FILE_TB(
			FILE_GRP_FK, MEM_FK,
			FILE_REG_DT, FILE_SIZE,
			EXT_NM, ORGN_FILE_NM,
			SAVE_FILE_NM, FILE_SAVE_DIR
		)VALUES(
			#{fileGroupNo}, #{memNo},
			CURRENT_TIMESTAMP(), #{fileSize},
			#{extensionName}, #{originalFileName},
			#{saveFileName}, #{fileSaveDirectory}
		)
		<selectKey resultType="java.lang.Integer" keyProperty="fileNo" order="AFTER">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	
	<!-- 특정 파일 그룹 일련 번호에 속한 파일들을 조회합니다. -->
	<select id="selectFileByFileGroupNo" parameterType="java.lang.Integer" resultMap="FileVO">
		SELECT
			FILE_SQ_PK, FILE_SIZE,
			ORGN_FILE_NM, SAVE_FILE_NM
		FROM
			FILE_TB
		WHERE
			FILE_GRP_FK = #{fileGrpNo}
		ORDER BY
			FILE_SQ_PK ASC
	</select>
	
	<!-- 특정 파일 그룹을 등록한 계정의 일련 번호 조회 -->
	<select id="selectMemNoOfFileGroupByFileGroupNo" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		SELECT	MEM_FK
		FROM	FILE_GRP_TB
		WHERE	FILE_GRP_SQ_PK = #{fileGroupNo}
	</select>
</mapper>